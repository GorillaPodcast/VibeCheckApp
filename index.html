<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>VibeCheck Pro</title>

```
<!-- PWA Primary Meta -->
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="VibeCheck">
<meta name="theme-color" content="#020617">

<!-- Embedded SVG Icon -->
<link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImciIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM4YjVjZjY7c3RvcC1vcGFjaXR5OjEiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM3YzNhZWQ7c3RvcC1vcGFjaXR5OjEiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgcng9Ijc2IiBmaWxsPSJ1cmwoI2cpIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCBCbGFjaywgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIzNjAiIGZvbnQtd2VpZ2h0PSI5MDAiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0iY2VudHJhbCI+VjwvdGV4dD48L3N2Zz4=">
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImciIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM4YjVjZjY7c3RvcC1vcGFjaXR5OjEiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM3YzNhZWQ7c3RvcC1vcGFjaXR5OjEiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgcng9Ijc2IiBmaWxsPSJ1cmwoI2cpIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCBCbGFjaywgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIzNjAiIGZvbnQtd2VpZ2h0PSI5MDAiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0iY2VudHJhbCI+VjwvdGV4dD48L3N2Zz4=">

<!-- PWA Manifest -->
<link rel="manifest" href="#" id="manifest-link">

<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
    @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
    
    :root {
        --bg: #020617;
        --violet: #8b5cf6;
        --pink: #f472b6;
    }

    body {
        font-family: 'Plus Jakarta Sans', sans-serif;
        background-color: var(--bg);
        color: #f1f5f9;
        margin: 0;
        padding: 0;
        -webkit-tap-highlight-color: transparent;
    }

    /* Glassmorphism */
    .glass {
        background: rgba(15, 23, 42, 0.7);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .gradient-text {
        background: linear-gradient(135deg, #a78bfa 0%, #f472b6 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    /* Overlay for Browser users */
    .gatekeeper-overlay {
        position: fixed;
        inset: 0;
        background: var(--bg);
        z-index: 9999;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        text-align: center;
    }

    .performance-tag {
        color: var(--pink);
        font-weight: 800;
        font-style: italic;
        background: rgba(244, 114, 182, 0.1);
        padding: 2px 6px;
        border-radius: 4px;
    }

    /* Animations */
    @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-15px); }
    }
    .bounce-arrow { animation: bounce 2s infinite; }

    .shimmer {
        background: linear-gradient(90deg, #1e293b 25%, #334155 50%, #1e293b 75%);
        background-size: 200% 100%;
        animation: shimmerEffect 1.5s infinite linear;
    }
    @keyframes shimmerEffect { to { background-position: -200% 0; } }

    #main-content { display: none; opacity: 0; transition: opacity 0.5s ease-in; }
</style>
```

</head>
<body>

```
<!-- GATEKEEPER SCREEN -->
<div id="gatekeeper" class="gatekeeper-overlay">
    <div class="w-24 h-24 bg-violet-600 rounded-[2rem] mb-8 flex items-center justify-center shadow-2xl shadow-violet-500/40">
        <span class="text-white text-5xl font-black">V</span>
    </div>
    <h1 class="text-4xl font-black mb-4 tracking-tighter">VibeCheck <span class="gradient-text">Pro</span></h1>
    <p class="text-slate-400 max-w-xs mb-12 leading-relaxed">This professional tool requires installation to your Home Screen to unlock native features.</p>
    
    <div id="ios-instructions" class="hidden space-y-6">
        <div class="glass p-6 rounded-3xl border border-violet-500/20">
            <p class="text-sm font-bold mb-4">1. Tap the <i class="fa-solid fa-share-from-square text-violet-400 mx-1"></i> share icon</p>
            <p class="text-sm font-bold">2. Select <span class="text-white bg-violet-600 px-2 py-1 rounded ml-1">Add to Home Screen</span></p>
        </div>
        <div class="bounce-arrow text-violet-500 text-3xl pt-10">
            <i class="fa-solid fa-chevron-down"></i>
        </div>
    </div>

    <div id="android-instructions" class="hidden">
        <button onclick="installAndroid()" class="bg-violet-600 hover:bg-violet-500 text-white px-10 py-5 rounded-2xl font-black shadow-xl">
            INSTALL APP NOW
        </button>
    </div>
</div>

<!-- MAIN APP -->
<div id="main-content" class="min-h-screen p-4 md:p-8 lg:p-12 pb-24">
    <nav class="flex justify-between items-center mb-10 max-w-7xl mx-auto">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-violet-600 rounded-xl flex items-center justify-center shadow-lg shadow-violet-500/30">
                <span class="text-white font-black">V</span>
            </div>
            <h1 class="text-xl font-black tracking-tighter">VibeCheck <span class="text-violet-500">Pro</span></h1>
        </div>
        <button onclick="openSettings()" class="w-12 h-12 glass rounded-full flex items-center justify-center text-slate-400 hover:text-white transition-all">
            <i class="fa-solid fa-key"></i>
        </button>
    </nav>

    <main class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">
        <!-- Left: Inputs -->
        <div class="lg:col-span-4 space-y-6">
            <div class="glass p-6 rounded-[2.5rem] space-y-6">
                <div>
                    <label class="text-[10px] uppercase font-black text-slate-500 tracking-widest mb-2 block">Dialect Mode</label>
                    <select id="dialect" class="w-full bg-slate-950 border border-white/5 rounded-2xl p-4 font-bold text-white outline-none focus:border-violet-500">
                        <option value="UK Roadman (MLE)">UK Roadman</option>
                        <option value="Jamaican Patois">Jamaican Patois</option>
                        <option value="Nigerian Pidgin">Nigerian Pidgin</option>
                        <option value="German-English">German Accent</option>
                        <option value="NY Bronx">NY Bronx</option>
                    </select>
                </div>
                <textarea id="script-input" class="w-full h-48 bg-slate-950/50 border border-white/5 rounded-2xl p-5 text-slate-200 leading-relaxed outline-none focus:border-violet-500" placeholder="Paste standard script..."></textarea>
                <textarea id="base-image" class="w-full h-24 bg-slate-950/50 border border-white/5 rounded-2xl p-5 text-sm text-slate-400 outline-none focus:border-violet-500" placeholder="Base Image: Gorilla in studio..."></textarea>
                <button onclick="generate()" id="gen-btn" class="w-full bg-violet-600 py-5 rounded-2xl font-black text-white shadow-2xl shadow-violet-600/30 active:scale-95 transition-all">
                    DIRECT SCENES
                </button>
            </div>
        </div>

        <!-- Right: Display -->
        <div class="lg:col-span-8">
            <div id="output-stage" class="glass rounded-[2.5rem] min-h-[600px] p-6">
                <div id="idle-view" class="h-[500px] flex flex-col items-center justify-center opacity-20 text-center">
                    <i class="fa-solid fa-wand-magic-sparkles text-7xl mb-6"></i>
                    <p class="font-black text-xl uppercase tracking-widest">Awaiting Command</p>
                </div>
                <div id="loader" class="hidden space-y-6 py-10">
                    <div class="h-40 shimmer rounded-3xl w-full"></div>
                    <div class="h-40 shimmer rounded-3xl w-full"></div>
                </div>
                <div id="scene-list" class="hidden space-y-12"></div>
            </div>
        </div>
    </main>
</div>

<!-- SETTINGS MODAL -->
<div id="settings" class="fixed inset-0 z-[10000] bg-black/95 backdrop-blur-xl hidden flex items-center justify-center p-6">
    <div class="glass w-full max-w-md p-8 rounded-[2.5rem] border border-violet-500/30">
        <h2 class="text-2xl font-black mb-2">API Vault</h2>
        <p class="text-slate-400 text-sm mb-8">Enter your Gemini API key. This is stored locally and never shared.</p>
        <input type="password" id="api-key" class="w-full bg-slate-950 border border-white/10 rounded-xl p-4 mb-6 text-white outline-none focus:border-violet-500" placeholder="sk-...">
        <div class="flex gap-3">
            <button onclick="saveKey()" class="flex-grow bg-violet-600 py-4 rounded-xl font-bold">Save</button>
            <button onclick="closeSettings()" class="px-6 bg-slate-800 py-4 rounded-xl font-bold">Close</button>
        </div>
    </div>
</div>

<script>
    // Generate manifest dynamically with embedded icon
    const iconDataUri = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImciIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM4YjVjZjY7c3RvcC1vcGFjaXR5OjEiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM3YzNhZWQ7c3RvcC1vcGFjaXR5OjEiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgcng9Ijc2IiBmaWxsPSJ1cmwoI2cpIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCBCbGFjaywgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIzNjAiIGZvbnQtd2VpZ2h0PSI5MDAiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0iY2VudHJhbCI+VjwvdGV4dD48L3N2Zz4=';
    
    const pwaManifest = {
        "name": "VibeCheck Pro Director",
        "short_name": "VibeCheck",
        "start_url": "./",
        "display": "standalone",
        "background_color": "#020617",
        "theme_color": "#020617",
        "orientation": "portrait",
        "scope": "./",
        "icons": [
            {
                "src": iconDataUri,
                "sizes": "512x512",
                "type": "image/svg+xml",
                "purpose": "any maskable"
            }
        ]
    };

    // Create manifest blob
    const manifestBlob = new Blob([JSON.stringify(pwaManifest)], { type: 'application/json' });
    const manifestURL = URL.createObjectURL(manifestBlob);
    document.getElementById('manifest-link').setAttribute('href', manifestURL);

    // Register Service Worker
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./sw.js').then(() => {
            console.log('Service Worker Registered');
        }).catch(err => {
            console.log('SW registration failed', err);
        });
    }

    // --- PWA GATEKEEPER ---
    function checkStandalone() {
        const isStandalone = window.matchMedia('(display-mode: standalone)').matches || 
                             window.navigator.standalone === true ||
                             document.referrer.includes('android-app://');
        
        if (isStandalone) {
            document.getElementById('gatekeeper').style.display = 'none';
            const main = document.getElementById('main-content');
            main.style.display = 'block';
            setTimeout(() => main.style.opacity = '1', 100);
        } else {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            if (isIOS) {
                document.getElementById('ios-instructions').classList.remove('hidden');
            } else {
                document.getElementById('android-instructions').classList.remove('hidden');
            }
        }
    }

    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
    });

    function installAndroid() {
        if (deferredPrompt) {
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then(res => { 
                if(res.outcome === 'accepted') {
                    setTimeout(checkStandalone, 500);
                }
            });
        }
    }

    // --- LOGIC ---
    function openSettings() { document.getElementById('settings').classList.remove('hidden'); }
    function closeSettings() { document.getElementById('settings').classList.add('hidden'); }
    function saveKey() {
        localStorage.setItem('v_api_key', document.getElementById('api-key').value);
        closeSettings();
    }

    async function generate() {
        const key = localStorage.getItem('v_api_key');
        if (!key) { openSettings(); return; }

        const script = document.getElementById('script-input').value.trim();
        const base = document.getElementById('base-image').value.trim();
        const accent = document.getElementById('dialect').value;

        if (!script || !base) return;

        // UI
        document.getElementById('idle-view').classList.add('hidden');
        document.getElementById('scene-list').classList.add('hidden');
        document.getElementById('loader').classList.remove('hidden');
        const btn = document.getElementById('gen-btn');
        btn.disabled = true;
        btn.innerText = "DIRECTING...";

        const system = `Director Brain. Analyze subtext, add [Sighs], [Nods], [Laughs] automatically. Rewrite in ${accent}. Return JSON: { "scenes": [ { "audio": "...", "image": "...", "video": "..." } ] }`;

        try {
            const resp = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${key}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: `SCRIPT: ${script}\nBASE: ${base}` }] }],
                    systemInstruction: { parts: [{ text: system }] },
                    generationConfig: { responseMimeType: "application/json" }
                })
            });

            const data = await resp.json();
            const result = JSON.parse(data.candidates[0].content.parts[0].text);
            render(result.scenes);
        } catch (e) {
            alert("Check API Key in settings.");
        } finally {
            btn.disabled = false;
            btn.innerText = "DIRECT SCENES";
            document.getElementById('loader').classList.add('hidden');
        }
    }

    function render(scenes) {
        const list = document.getElementById('scene-list');
        list.innerHTML = '';
        scenes.forEach((s, i) => {
            const div = document.createElement('div');
            div.className = "p-8 glass rounded-[2.5rem] space-y-6";
            div.innerHTML = `
                <div class="flex items-center gap-2"><span class="bg-violet-600 text-[10px] font-black px-2 py-0.5 rounded">SCENE ${i+1}</span></div>
                <div class="p-5 bg-slate-950/80 rounded-2xl border border-white/5 text-lg font-medium relative">
                    ${s.audio.replace(/\[(.*?)\]/g, '<span class="performance-tag">[$1]</span>')}
                    <button onclick="copyT(this, '${s.audio.replace(/'/g, "\\'")}')" class="absolute top-4 right-4 text-slate-500"><i class="fa-regular fa-copy"></i></button>
                </div>
                <div class="text-xs text-slate-400 italic p-4 border border-white/5 rounded-2xl relative">
                    ${s.image}
                    <button onclick="copyT(this, '${s.image.replace(/'/g, "\\'")}')" class="absolute top-4 right-4 text-slate-500"><i class="fa-regular fa-copy"></i></button>
                </div>
                <div class="text-xs font-mono text-emerald-400 p-4 bg-emerald-950/20 rounded-2xl border border-emerald-500/20 relative">
                    ${s.video}
                    <button onclick="copyT(this, '${s.video.replace(/'/g, "\\'")}')" class="absolute top-4 right-4 text-slate-500"><i class="fa-regular fa-copy"></i></button>
                </div>
            `;
            list.appendChild(div);
        });
        list.classList.remove('hidden');
    }

    window.copyT = (btn, t) => {
        const el = document.createElement('textarea'); el.value = t; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el);
        btn.innerHTML = '<i class="fa-solid fa-check text-emerald-500"></i>';
        setTimeout(() => btn.innerHTML = '<i class="fa-regular fa-copy"></i>', 2000);
    };

    window.onload = checkStandalone;
</script>
```

</body>
</html>
